# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 時間設定

**重要**: このプロジェクトでは日本標準時（JST）を基準とします。
- 「今日」は常に日本標準時の現在日付を指す
- ファイル名の日付フォーマットは `yyyymmdd` 形式で日本標準時を使用
- 記録作成時は `date` コマンドで実際のシステム日付を確認してから作業する
- Claude Code環境の日付設定に依存せず、実際のシステム日付を優先する

## プロジェクトの概要

これはJavaScriptを用いたブロック崩しゲームです。MDNのチュートリアルをベースに作成します。

## 目的

目的はブロック崩しゲームをつくることではなく、技術力の向上です。AIが出力するコードを自在に扱えるようになる必要があります。

# ブロック崩しゲーム開発方針

## プロジェクト概要

JavaScriptとCanvas APIを使用してブラウザ上で動作するブロック崩しゲームを作成します。MDNのチュートリアルをベースとしつつ、技術力向上を目的として段階的に機能を追加していきます。

## 技術選択

### コア技術

- **HTML5 Canvas**: ゲームの描画とアニメーション
- **Vanilla JavaScript**: フレームワークを使わずピュアJavaScriptで実装
- **CSS3**: UI装飾とレスポンシブデザイン

### 選択理由

1. **Canvas API**: 2Dゲームに最適で、ピクセル単位の制御が可能
2. **Vanilla JS**: 基本的なJavaScript技術の習得とパフォーマンス重視
3. **モジュール化**: ES6 modulesを使用してコードの再利用性を向上

## 開発フェーズ

### Phase 1: 基本実装

- [x] プロジェクト構成の決定
- [x] HTML構造の作成
- [x] Canvas要素の設定
- [x] ボールの描画と移動
- [ ] パドルの描画と操作
- [ ] 衝突判定の基本実装

### Phase 2: ゲームロジック

- [ ] ブロックの生成と配置
- [ ] ブロックとボールの衝突判定
- [ ] スコアシステム
- [ ] ゲームオーバー/クリア判定
- [ ] ライフシステム

### Phase 3: 機能拡張

- [ ] 効果音の追加
- [ ] パーティクルエフェクト
- [ ] 複数レベル
- [ ] パワーアップアイテム
- [ ] ハイスコア保存

### Phase 4: 最適化・改善

- [ ] パフォーマンス最適化
- [ ] レスポンシブデザイン対応
- [ ] タッチ操作対応（モバイル）
- [ ] コードリファクタリング

## ファイル構成

```
/
├── index.html          # メインHTMLファイル
├── css/
│   └── style.css      # スタイルシート
├── js/
│   ├── main.js        # メインゲームループ
│   ├── ball.js        # ボールクラス
│   ├── paddle.js      # パドルクラス
│   ├── brick.js       # ブロッククラス
│   ├── game.js        # ゲーム制御クラス
│   └── utils.js       # ユーティリティ関数
└── assets/
    ├── sounds/        # 効果音ファイル
    └── images/        # 画像ファイル
```

## 主要なクラス設計

### Game クラス

- ゲーム全体の制御
- ゲームループの管理
- 状態管理（開始、一時停止、終了）

### Ball クラス

- ボールの位置、速度、描画
- 移動と衝突判定

### Paddle クラス

- パドルの位置、描画
- ユーザー入力による移動

### Brick クラス

- 個別ブロックの状態管理
- 破壊判定とスコア計算

## 技術的な課題と解決策

### 1. 滑らかなアニメーション

**課題**: フレームレートの安定化
**解決策**: requestAnimationFrame()を使用してブラウザの描画サイクルに同期

### 2. 正確な衝突判定

**課題**: ボールとオブジェクト間の衝突検出
**解決策**: AABB（軸平行境界ボックス）衝突判定とベクトル反射計算

### 3. レスポンシブ対応

**課題**: 異なる画面サイズでの適応
**解決策**: Canvas要素のCSS設定とゲーム座標系の正規化

## 代替技術選択の検討

### WebGL vs Canvas 2D

- **WebGL**: 3D効果や高度なシェーダーが可能だが複雑
- **Canvas 2D**: シンプルで学習コストが低い（選択）

### フレームワーク vs Vanilla JS

- **Phaser.js**: ゲーム開発に特化した豊富な機能
- **Vanilla JS**: 基礎技術の習得に最適（選択）

### TypeScript vs JavaScript

- **TypeScript**: 型安全性と開発効率
- **JavaScript**: シンプルさと学習の焦点（選択）

## テスト戦略

### テストアプローチ

JavaScriptゲーム開発では描画処理とビジネスロジックを分離してテストします。Canvas APIの描画部分は直接テストが困難なため、計算ロジックに集中したテスト設計を行います。

### テストフレームワーク

- **Jest**: メインテストフレームワーク
- **@jest/globals**: ES6モジュール対応
- **jest-environment-jsdom**: DOM環境のシミュレーション

### テスト対象

#### テスト可能な部分（重点対象）

- **衝突判定の計算**: ボール・パドル・ブロック間の数学的計算
- **スコア計算**: ブロック破壊やボーナスポイントの算出
- **ゲーム状態管理**: 開始・終了・一時停止の状態遷移
- **ボール・パドルの位置計算**: 移動量とバウンス計算

#### テスト困難な部分（モック化/統合テスト）

- Canvas描画処理
- ユーザー入力処理（キーボード・マウス）
- requestAnimationFrame等のブラウザAPI

### テスト構成

```
test/
├── unit/
│   ├── ball.test.js      # ボールクラスの単体テスト
│   ├── paddle.test.js    # パドルクラスの単体テスト
│   ├── brick.test.js     # ブロッククラスの単体テスト
│   ├── game.test.js      # ゲーム制御の単体テスト
│   └── utils.test.js     # ユーティリティ関数のテスト
├── integration/
│   └── gameflow.test.js  # ゲーム全体の統合テスト
└── setup/
    ├── jest.config.js    # Jest設定ファイル
    └── testUtils.js      # テスト用ヘルパー関数
```

### テスト例

```javascript
// ball.test.js の例
describe("Ball クラス", () => {
  test("壁との衝突でボールが反射する", () => {
    const ball = new Ball(10, 10, 2, 2);
    ball.checkWallCollision(800, 600);
    expect(ball.dx).toBe(-2); // x方向の速度が反転
  });
});
```

### テスト実行コマンド

```bash
npm test              # 全テスト実行
npm run test:watch    # ファイル変更時に自動実行
npm run test:coverage # カバレッジレポート生成
```

## ショートカットコマンド

### 「記録の準備をして」

1. `history-by-human`フォルダに今日の日付（yyyymmdd.md）のファイルを作成

2. `history-by-human`フォルダに作成したファイルの中身は

```
# 人間による記録
# Claudeによる指摘
```

と追記する。

### 「今日の記録をして」

以下の処理を自動実行：

1. `history-by-claude`フォルダに今日の日付（yyyymmdd.md）のファイルを作成

2. 技術的な決定の根拠と学習内容を明確に文書化
   作成してファイルに追記する。

- どのようなプロンプトを与えられ、何を生成したか
- 「こうすればより効果的だったのに」というプロンプトがあれば、それも書く

3. `history-by-human`フォルダの同日付ファイルを確認
4. 人間の記録内容を読み、技術的な過不足や改善点があれば「Claudeによる指摘」セクションに追記

## 記録

### 開発記録 (by Claude)

各フェーズの進捗は `/history-by-claude/yyyymmdd.md` 形式で記録し、技術的な決定の根拠と学習内容を明確に文書化します。

どのようなプロンプトを与えられ、何を生成したかを残します。
また、「こうすればより効果的だったのに」というプロンプトがあれば、それも合わせて教えてください。

### 開発記録 (by 人間)

開発者が学習したことを `/history-human/yyyymmdd.md` 形式で記録します。内容は以下の通り。

```
# 人間による記録
~~~~

# Claudeによる指摘

~~~~
```

「人間による記録」は人間が書きます。そこに過不足があれば「Claudeによる指摘」を書いてください。記載するタイミングはこちらが指示します。
